import React, { useState, useRef, useEffect } from 'react';
import { Printer, Image, FileText, Zap, Truck, Repeat, MessageCircle, X, Send, Sparkles, Loader2, Phone, MapPin, CreditCard, Navigation } from 'lucide-react';

const VladimirPrintingApp = () => {
  // --- GESTI√ìN DE ESTADO ---
  const [isChatOpen, setIsChatOpen] = useState(false);
  const [messages, setMessages] = useState([
    { role: 'model', text: '¬°Hola! üëã Bienvenido a Vladimir Impresiones. Dime qu√© necesitas imprimir y te doy el precio exacto al instante.' }
  ]);
  const [userInput, setUserInput] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const messagesEndRef = useRef(null);

  // --- AUTO SCROLL CHAT ---
  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages, isChatOpen]);

  // --- CONFIGURACI√ìN API GEMINI ---
  const apiKey = ""; 
  
  const handleSendMessage = async () => {
    if (!userInput.trim()) return;

    const newMessages = [...messages, { role: 'user', text: userInput }];
    setMessages(newMessages);
    setUserInput('');
    setIsLoading(true);

    try {
      const systemInstruction = `
        Eres una calculadora de precios para "Vladimir Impresiones".
        
        REGLAS DE COMPORTAMIENTO (ESTRICTAS):
        1. NO SALUDES. Ve DIRECTO al c√°lculo del precio.
        2. PRIORIDAD: Siempre asume "Blanco y Negro" si no especifican color.
        3. CLARIDAD EN EL PRECIO: Siempre especifica "c/u" o "por hoja" para evitar confusiones.
        4. CIERRE DE VENTA OBLIGATORIO: Siempre termina diciendo: "Y recuerda que te lo llevamos GRATIS a donde est√©s."

        LISTA DE PRECIOS ACTUALIZADA:
        
        1. COPIAS DE C√âDULA / ID:
           - Blanco y Negro: RD$5 c/u
           - Color: RD$10 c/u

        2. IMPRESI√ìN DOCUMENTOS BLANCO Y NEGRO (Estrategia de volumen):
           - 1 a 5 hojas: RD$10 c/u
           - 6 a 10 hojas: RD$8 c/u
           - 11 a 50 hojas: RD$5 c/u
           - M√°s de 50 hojas: RD$3.5 c/u (Precio m√≠nimo mayorista).

        3. IMPRESI√ìN A COLOR:
           - Color Simple: RD$15 c/u (Baja a RD$10 c/u si son >50 hojas).
           - Full Color: RD$25 c/u.

        4. DOBLE CARA:
           - Blanco y Negro: +RD$3 extra al precio base por hoja.
           - Color: RD$20 c/u (Simple) / RD$40 c/u (Full).

        Ejemplo respuesta ideal:
        "Para 60 hojas en Blanco y Negro, el precio baja a RD$3.5 c/u. Total: RD$210. Env√≠alo al WhatsApp y recuerda que te lo llevamos GRATIS a donde est√©s."
      `;

      const response = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [{ parts: [{ text: userInput }] }],
            systemInstruction: { parts: [{ text: systemInstruction }] },
          }),
        }
      );

      const data = await response.json();
      
      let botResponse = "Hubo un error calculando.";
      
      if (data.error) {
        console.error("API Error:", data.error);
        botResponse = "Lo siento, hubo un problema de conexi√≥n. Por favor revisa la lista de precios arriba.";
      } else {
        botResponse = data.candidates?.[0]?.content?.parts?.[0]?.text || "No entend√≠ la cantidad, ¬øpodr√≠as repetirla?";
      }

      setMessages([...newMessages, { role: 'model', text: botResponse }]);

    } catch (error) {
      setMessages([...newMessages, { role: 'model', text: "Error de conexi√≥n. Por favor verifica tu internet." }]);
    } finally {
      setIsLoading(false);
    }
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter') handleSendMessage();
  };

  return (
    <div className="min-h-screen bg-gray-50 font-sans pb-24 md:pb-0">
      
      {/* --- NAVBAR BRANDING --- */}
      <nav className="bg-white shadow-sm sticky top-0 z-40 border-b border-gray-100">
        <div className="max-w-5xl mx-auto px-4 py-3 flex justify-between items-center">
          <div className="flex items-center gap-2">
            <div className="bg-indigo-600 text-white p-2 rounded-lg">
              <Printer size={24} />
            </div>
            <div>
              <h1 className="text-xl font-bold text-gray-900 leading-none tracking-tight">Vladimir<span className="text-indigo-600">Impresiones</span></h1>
              <span className="text-xs text-gray-500 font-medium tracking-wide">CALIDAD & RAPIDEZ</span>
            </div>
          </div>
          <div className="hidden md:flex items-center gap-4 text-sm font-medium text-gray-600">
            <a href="https://wa.me/18497105798" target="_blank" rel="noopener noreferrer" className="flex items-center gap-1 hover:text-indigo-600 cursor-pointer transition-colors">
              <Phone size={16}/> 849-710-5798
            </a>
            <span className="flex items-center gap-1 hover:text-indigo-600 cursor-pointer"><MapPin size={16}/> Campus</span>
          </div>
        </div>
      </nav>

      {/* --- MAIN CONTENT --- */}
      <div className="max-w-5xl mx-auto p-4 md:p-8">
        
        {/* HERO CARD */}
        <div className="bg-indigo-900 rounded-3xl p-8 md:p-12 text-white mb-8 relative overflow-hidden shadow-2xl">
          <div className="absolute top-0 right-0 w-64 h-64 bg-indigo-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 -translate-y-1/2 translate-x-1/2"></div>
          <div className="absolute bottom-0 left-0 w-64 h-64 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 translate-y-1/2 -translate-x-1/2"></div>
          
          <div className="relative z-10 text-center md:text-left flex flex-col md:flex-row items-center justify-between gap-8">
            <div>
              {/* Delivery Badge */}
              <div className="inline-flex items-center gap-2 bg-green-500 text-white px-3 py-1 rounded-full text-xs font-bold mb-4 animate-pulse">
                <Truck size={14} /> ¬°ENV√çO GRATIS A DONDE EST√âS!
              </div>

              <h2 className="text-3xl md:text-5xl font-extrabold mb-4 leading-tight">
                Tu centro de impresi√≥n <br/>
                <span className="text-indigo-300">favorito en el campus.</span>
              </h2>
              <p className="text-indigo-100 text-lg mb-6 max-w-lg">
                Env√≠a tus archivos por WhatsApp y te los llevamos a donde te encuentres dentro del campus.
              </p>
              <div className="flex flex-wrap gap-3 justify-center md:justify-start">
                <button 
                  onClick={() => setIsChatOpen(true)}
                  className="bg-white text-indigo-900 px-6 py-3 rounded-xl font-bold hover:bg-indigo-50 transition-colors flex items-center gap-2 shadow-lg"
                >
                  <Sparkles size={18} className="text-yellow-500"/>
                  Cotizar Ahora
                </button>
                <a 
                  href="https://wa.me/18497105798"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="bg-indigo-800 text-white border border-indigo-600 px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 transition-colors flex items-center gap-2"
                >
                  <MessageCircle size={18} />
                  Enviar al 849-710-5798
                </a>
              </div>
            </div>
            
            {/* Badge Promocional */}
            <div className="bg-white/10 backdrop-blur-lg p-6 rounded-2xl border border-white/20 transform rotate-2 hover:rotate-0 transition-transform duration-300">
               <div className="text-center">
                  <span className="block text-4xl font-bold text-yellow-400">RD$3.5 <span className="text-lg text-white">c/u</span></span>
                  <span className="text-sm text-indigo-100 uppercase tracking-wider font-bold">Mayorista (+50)</span>
                  <div className="mt-2 text-xs bg-indigo-800 px-2 py-1 rounded">Blanco y Negro</div>
               </div>
            </div>
          </div>
        </div>

        {/* --- PRICING GRID --- */}
        <div className="grid md:grid-cols-3 gap-6 mb-8">
            
            {/* Card 1: Blanco y Negro (Principal) */}
            <div className="bg-white p-6 rounded-2xl shadow-md border-2 border-indigo-100 hover:border-indigo-300 transition-all transform hover:-translate-y-1 relative">
                <div className="absolute top-0 left-0 w-full h-1.5 bg-indigo-600 rounded-t-2xl"></div>
                <div className="flex justify-between items-start mb-4">
                  <div className="w-12 h-12 bg-indigo-50 rounded-full flex items-center justify-center text-indigo-700">
                      <FileText size={24}/>
                  </div>
                  <span className="bg-indigo-100 text-indigo-800 text-xs font-bold px-2 py-1 rounded-full">M√ÅS PEDIDO</span>
                </div>
                <h3 className="text-xl font-bold text-gray-900 mb-2">Blanco y Negro</h3>
                <p className="text-gray-500 text-sm mb-4">Texto, tareas, libros, informes.</p>
                
                <div className="space-y-3 bg-gray-50 p-3 rounded-xl">
                    <div className="flex justify-between items-center text-sm border-b border-gray-200 pb-2">
                      <span className="text-gray-600">1 a 5 hojas</span> 
                      <span className="font-bold text-gray-900 text-base">RD$10 c/u</span>
                    </div>
                    <div className="flex justify-between items-center text-sm border-b border-gray-200 pb-2">
                      <span className="text-gray-600">6 a 10 hojas</span> 
                      <span className="font-bold text-gray-900 text-base">RD$8 c/u</span>
                    </div>
                    <div className="flex justify-between items-center text-sm border-b border-gray-200 pb-2">
                      <span className="text-gray-600">11 a 50 hojas</span> 
                      <span className="font-bold text-gray-900 text-base">RD$5 c/u</span>
                    </div>
                    <div className="flex justify-between items-center text-sm bg-indigo-600 text-white p-2 rounded-lg -mx-1">
                      <span className="font-medium">+50 hojas</span> 
                      <span className="font-bold text-lg">RD$3.5 c/u</span>
                    </div>
                </div>
            </div>

            {/* Card 2: Color Simple */}
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:border-cyan-200 transition-all relative">
                <div className="w-12 h-12 bg-cyan-50 rounded-full flex items-center justify-center mb-4 text-cyan-600">
                    <Zap size={24}/>
                </div>
                <h3 className="text-xl font-bold text-gray-900 mb-2">Color Simple</h3>
                <p className="text-gray-500 text-sm mb-4">Logos peque√±os, t√≠tulos, gr√°ficos.</p>
                <div className="space-y-2">
                    <div className="flex justify-between text-sm items-center p-2 bg-cyan-50 rounded-lg">
                        <span>Normal</span> 
                        <span className="font-bold text-xl text-cyan-800">RD$15 c/u</span>
                    </div>
                    <div className="text-xs text-center text-gray-500 mt-2">
                        ¬øM√°s de 50 hojas? <span className="font-bold text-cyan-600">Baja a RD$10 c/u</span>
                    </div>
                </div>
            </div>

            {/* Card 3: Full Color */}
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:border-pink-200 transition-all">
                <div className="w-12 h-12 bg-pink-50 rounded-full flex items-center justify-center mb-4 text-pink-600">
                    <Image size={24}/>
                </div>
                <h3 className="text-xl font-bold text-gray-900 mb-2">Full Color</h3>
                <p className="text-gray-500 text-sm mb-4">Fotos, portadas, fondos s√≥lidos.</p>
                <div className="space-y-2">
                    <div className="flex justify-between text-sm items-center p-2 bg-pink-50 rounded-lg">
                        <span>Alta Calidad</span> 
                        <span className="font-bold text-xl text-pink-800">RD$25 c/u</span>
                    </div>
                     <div className="text-xs text-center text-gray-500 mt-2">
                        Aplica para im√°genes grandes.
                    </div>
                </div>
            </div>
        </div>

        {/* --- DELIVERY & SERVICES BANNER --- */}
        <div className="bg-green-600 text-white rounded-2xl p-6 flex flex-col md:flex-row items-center justify-between gap-6 shadow-xl mb-8 transform hover:scale-[1.01] transition-transform">
             <div className="flex items-center gap-4">
                 <div className="bg-white p-4 rounded-full text-green-600 shadow-md">
                     <Truck size={32} />
                 </div>
                 <div>
                     <h3 className="text-2xl font-bold">¬°Te lo llevamos GRATIS!</h3>
                     <p className="text-green-100 text-lg">A donde est√©s (Campus o alrededores).</p>
                 </div>
             </div>
             <a href="https://wa.me/18497105798" className="bg-white text-green-700 font-bold py-3 px-6 rounded-xl hover:bg-green-50 transition-colors shadow-lg">
                 Pedir Env√≠o Ahora
             </a>
        </div>

        {/* --- SMALL SERVICES ROW --- */}
        <div className="grid md:grid-cols-2 gap-6 mb-8">
            {/* C√©dulas */}
            <div className="bg-gray-800 text-white rounded-2xl p-5 flex items-center justify-between shadow-lg">
                <div className="flex items-center gap-4">
                  <div className="bg-white/10 p-3 rounded-full"><CreditCard size={24}/></div>
                  <div>
                    <h4 className="font-bold text-lg">Copia de C√©dula</h4>
                    <p className="text-gray-300 text-xs">O documentos ID peque√±os</p>
                  </div>
                </div>
                <div className="text-right">
                   <div className="text-sm"><span className="text-gray-400">B. y Negro:</span> <span className="font-bold text-lg">RD$5 c/u</span></div>
                   <div className="text-sm"><span className="text-gray-400">Color:</span> <span className="font-bold text-lg">RD$10 c/u</span></div>
                </div>
            </div>

            {/* Doble Cara */}
            <div className="bg-white border border-gray-200 rounded-2xl p-5 flex items-center gap-4 shadow-sm">
                 <div className="bg-orange-100 p-3 rounded-full text-orange-600"><Repeat size={24}/></div>
                 <div className="flex-1">
                    <h4 className="font-bold text-gray-900">Doble Cara</h4>
                    <p className="text-gray-500 text-xs">Blanco y Negro: <span className="font-bold text-gray-800">+RD$3 extra/hoja</span></p>
                    <p className="text-gray-500 text-xs">Color: <span className="font-bold text-gray-800">RD$20 c/u (Simple) / RD$40 c/u (Full)</span></p>
                 </div>
            </div>
        </div>
      </div>

      {/* --- FOOTER SIMULATION --- */}
      <footer className="bg-white border-t border-gray-200 mt-8 py-8">
        <div className="max-w-5xl mx-auto px-4 text-center">
            <p className="font-bold text-gray-900 text-lg mb-2">Vladimir Impresiones</p>
            <div className="flex justify-center gap-4 mt-4 text-sm font-medium text-indigo-600">
                <a href="https://wa.me/18497105798" className="hover:underline flex items-center gap-1 bg-green-50 px-3 py-1 rounded-full text-green-700">
                  <Phone size={14}/> WhatsApp: 849-710-5798
                </a>
                <span className="flex items-center gap-1 text-gray-500"><MapPin size={14}/> Campus</span>
            </div>
        </div>
      </footer>

      {/* --- FLOATING AI WIDGET --- */}
      <button 
        onClick={() => setIsChatOpen(!isChatOpen)}
        className="fixed bottom-6 right-6 bg-indigo-600 text-white p-4 rounded-full shadow-2xl hover:bg-indigo-700 transition-all z-50 flex items-center gap-2 ring-4 ring-indigo-100"
      >
        {isChatOpen ? <X size={24} /> : <Sparkles size={24} />}
        <span className="font-bold hidden md:inline">{isChatOpen ? 'Cerrar' : 'Cotizar'}</span>
      </button>

      {/* --- CHAT WINDOW --- */}
      {isChatOpen && (
        <div className="fixed bottom-24 right-6 w-[90vw] md:w-96 h-[500px] bg-white rounded-2xl shadow-2xl z-50 flex flex-col border border-gray-200 overflow-hidden animate-in slide-in-from-bottom-5 fade-in duration-300">
          <div className="bg-indigo-600 p-4 text-white flex items-center justify-between">
            <div className="flex items-center gap-2">
                <div className="bg-white/20 p-1.5 rounded-lg"><Sparkles size={16} /></div>
                <div>
                    <h3 className="font-bold text-sm">Asistente Virtual</h3>
                    <p className="text-[10px] text-indigo-200">Prioridad Blanco y Negro</p>
                </div>
            </div>
          </div>

          <div className="flex-1 p-4 overflow-y-auto bg-gray-50 space-y-4">
            {messages.map((msg, idx) => (
              <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                <div className={`max-w-[85%] p-3 rounded-2xl text-sm ${
                  msg.role === 'user' 
                    ? 'bg-indigo-600 text-white rounded-br-none' 
                    : 'bg-white text-gray-800 border border-gray-100 shadow-sm rounded-bl-none'
                }`}>
                  {msg.text}
                </div>
              </div>
            ))}
            {isLoading && (
              <div className="flex justify-start">
                 <div className="bg-white p-3 rounded-2xl rounded-bl-none border border-gray-100 shadow-sm">
                    <Loader2 size={16} className="animate-spin text-indigo-600" />
                 </div>
              </div>
            )}
            <div ref={messagesEndRef} />
          </div>

          <div className="p-3 bg-white border-t border-gray-100 flex gap-2">
            <input
              type="text"
              value={userInput}
              onChange={(e) => setUserInput(e.target.value)}
              onKeyDown={handleKeyPress}
              placeholder="Ej: 60 hojas..."
              className="flex-1 bg-gray-100 border-0 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none"
            />
            <button 
              onClick={handleSendMessage}
              disabled={isLoading || !userInput.trim()}
              className="bg-indigo-600 text-white p-3 rounded-xl hover:bg-indigo-700 transition-colors disabled:opacity-50"
            >
              <Send size={18} />
            </button>
          </div>
        </div>
      )}

    </div>
  );
};

export default VladimirPrintingApp;


          
